<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Twilio Incoming Call Flow Generator</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <script>
      $(function(){
        const repoOwner = "Andrewiski";
        const repoName = "TwilioCallFlowGenerator";
        const repoHeaders = {"Accept": "application/vnd.github.v3+json"};
        const repoUrlRoot = "https://api.github.com/repos/"
        var commonData = {
          ServiceSid : "",
          accountSid : "",
          authToken : "",
          functionVersions: [],
          assetVersions: []
        }

        let rootUrl = "https://serverless.twilio.com/v1";
        let rootUrlServerless = "https://serverless-upload.twilio.com/v1";

        // $.ajaxPrefilter(function(options, originalOptions, jqXHR) {
        //   if(options.headers['DNT']){
        //     delete options.headers['DNT'];
        //   }
        // });
        

        var getAssetsList = function(options){ 
          var deferred = $.Deferred();
          try{         
          var url = rootUrl + "/Services/" + options.ServiceSid + "/Assets?PageSize=20";
          var ajaxOptions = {
            url: url, 
            headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
            type: "GET",
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: null
          }
          $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var getRepoTags = function(){
          var deferred = $.Deferred();
          try{
            var url = repoUrlRoot + repoOwner + "/" + repoName + "/tags";
            var ajaxOptions = {
              url: url, 
              headers: repoHeaders,
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }
        var upgradeService = function(options){          
          var deferred = $.Deferred();
          try{
            commonData.functionVersions = [];
            $.when(
              getFunctionList({ServiceSid : options.ServiceSid}),
              getRepoFunctionList({sha:options.repoVersionSha})
            ).then(
              function(functionList, repoFunctionList){

                for(let i = 0; i < repoFunctionList.length; i++){
                  var repoFunction = repoFunctionList[i];
                  let filenameNoExtention = repoFunction.path.substring(0, repoFunction.path.lastIndexOf('.')) || repoFunction.path;
                  var serviceFunction = null;
                  for(let k = 0; k < functionList.functions.length; k++){
                    let _function = functionList.functions[k];
                    if (filenameNoExtention === _function.friendly_name){
                      serviceFunction = _function;
                      break;
                    }
                  }
                  
                  if(serviceFunction === null){
                    createFunction({"FriendlyName": filenameNoExtention, ServiceSid : options.ServiceSid}).then(
                      function(functionResult){
                        let functionVersionData = {ServiceSid : options.ServiceSid, FunctionSid: functionResult.sid, fileName: repoFunction.path, path: "/" + filenameNoExtention, contentUrl: repoFunction.url  }
                        createFunctionVersion(functionVersionData).then(
                          function(){
                            commonData.functionVersions.push(functionVersionData);
                          },
                          function(ex){
                            deferred.reject(ex);
                          }
                        )  
                      },
                      function(ex){
                        deferred.reject(ex);
                      }
                    )
                  }else{
                    let functionVersionData = {ServiceSid : options.ServiceSid, FunctionSid: serviceFunction.sid, fileName: repoFunction.path, path: "/" + filenameNoExtention, contentUrl: repoFunction.url  }
                    createFunctionVersion(functionVersionData).then(
                      function(){
                        commonData.functionVersions.push(functionVersionData);
                      },
                      function(ex){
                        deferred.reject(ex);
                      }
                    
                    )  
                  }
                }
              },
              function(ex){
                deferred.reject(ex);
              }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
          
        }

        // var getRepoTags = function(){ 
        //   var deferred = $.Deferred();
        //   try{         
        //     var url =  repoUrlRoot + repoOwner + "/" + repoName + "/tags"; ;
        //     var ajaxOptions = {
        //       url: url, 
        //       //headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
        //       type: "GET",
        //       contentType: 'application/json; charset=utf-8',
        //       dataType: 'json',
        //       data: null
        //     }
        //     $.ajax(ajaxOptions).then(
        //       function(retval){
        //         deferred.resolve(retval);
        //       },
        //       function( jqXHR, textStatus, errorThrown){
        //           deferred.reject(errorThrown);
        //       }
        //     )
        //   }catch(ex){
        //     deferred.reject(ex);
        //   }
        //   return deferred.promise();
        // }

        var getRepoTagTree = function(options){ 
          var deferred = $.Deferred();
          try{         
            var url =  repoUrlRoot + repoOwner + "/" + repoName + "/git/trees/" + options.sha; ;
            var ajaxOptions = {
              url: url, 
              headers: repoHeaders,
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
          
        }

        var getRepoFunctionList = function(options){  
          var deferred = $.Deferred();
        
          try{
            getRepoTagTree(options).then(
              function(treeData){
                var functionsTree = null;
                for (let i = 0; i < treeData.tree.length; i++) {
                  var item = treeData.tree[i];
                  if(item.path==="functions"){
                    functionsTree = item;
                    break;
                  }
                }
                if (functionsTree === null){
                  throw new Error("functions not found in Repo")
                }else{
                  getRepoTagTree({sha: functionsTree.sha}).then(
                    function(functionsTree){
                      deferred.resolve(functionsTree.tree);
                    },
                    function( jqXHR, textStatus, errorThrown){
                      deferred.reject(errorThrown);
                    }
                  )
                }
              },
              function( jqXHR, textStatus, errorThrown){
                deferred.reject(errorThrown);
              }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        function base64toBlob(base64Data, contentType) {
          contentType = contentType || '';
          var sliceSize = 1024;
          var byteCharacters = atob(base64Data);
          var bytesLength = byteCharacters.length;
          var slicesCount = Math.ceil(bytesLength / sliceSize);
          var byteArrays = new Array(slicesCount);

          for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {
              var begin = sliceIndex * sliceSize;
              var end = Math.min(begin + sliceSize, bytesLength);

              var bytes = new Array(end - begin);
              for (var offset = begin, i = 0; offset < end; ++i, ++offset) {
                  bytes[i] = byteCharacters[offset].charCodeAt(0);
              }
              byteArrays[sliceIndex] = new Uint8Array(bytes);
          }
          return new Blob(byteArrays, { type: contentType });
      }

        var getRepoFileContents = function(options){  
          var deferred = $.Deferred();
        
          try{
            var url =  options.url ;
            var ajaxOptions = {
              url: url, 
              headers: repoHeaders,
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var getFunctionList = function(options){  
          var deferred = $.Deferred();
          try{        
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Functions" ;
            var ajaxOptions = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var getFunctionVersionList = function(options){ 
          var deferred = $.Deferred();
          try{                 
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Functions/" + options.FunctionSid + "/Versions";
            var ajaxOptions = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var getFunctionVersion = function(options){ 
          var deferred = $.Deferred();
          try{          
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Functions/" + options.FunctionSid + "/Versions/" + + options.FunctionVersionSid;
            var ajaxOptions = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createFunction = function(options){  
          var deferred = $.Deferred();
          try{         
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Functions" ;
            var data = {FriendlyName: options.FriendlyName}
            var ajaxOptions = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(ajaxOptions).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }
        var createFunctionVersion = function(options){ 
          var deferred = $.Deferred();
        
          try{         
            var url = rootUrlServerless + "/Services/" + options.ServiceSid + "/Functions/" + options.FunctionSid + "/Versions" ;
            var formData = new FormData();
            getRepoFileContents({url:options.contentUrl}).then(
              function(repoFileData){
                //var content = data.fileContent; // the body of the new file...
                var blob = base64toBlob(repoFileData.content,"application/javascript") //new Blob([content], { type: "text/javascript"});
                formData.append("Path", options.path);
                formData.append("Visibility", "public")
                formData.append(options.fileName, blob);
                var ajaxOptions = {
                  url: url, 
                  headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
                  type: "POST",
                  contentType: 'multipart/form-data',
                  processData: false,
                  // xhrFields: {
                  //   withCredentials: true
                  // },
                  crossDomain: false,
                  dataType: 'json',
                  data: formData
                  //crossDomain: true
                }
                $.ajax(ajaxOptions).then(
                  function(functionVersionData){
                    deferred.resolve(functionVersionData);
                  },
                  function( jqXHR, textStatus, errorThrown){
                      deferred.reject(errorThrown);
                    }
                )
              },
              function(ex){
                deferred.reject(ex);
              }
            )
            
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createService = function(data){ 
          var deferred = $.Deferred();
          try{                 
            var url = rootUrl + "/Services";
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }
        var deleteService = function(data){  
          var deferred = $.Deferred();
          try{                
            var url = rootUrl + "/Services/" + data.ServiceSid;
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "DELETE",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createEnvironment = function(data){
          var deferred = $.Deferred();
          try{        
            var url = rootUrl + "/Services/" + data.ServiceSid + "/Environments";
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createBuild = function(options){
          var deferred = $.Deferred();
          try{        
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Builds";
            var data = {};
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createVariable = function(data){
          var deferred = $.Deferred();
          try{        
            var url = rootUrl + "/Services/" + commonData.serviceId + "/Enviroments/" + "/Environments/" + commonData.EnvironmentSid + "/Variables";
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var checkBuildStatus = function(options){
          var deferred = $.Deferred();
          try{        
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Builds/" + options.BuildSid;
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: null
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var deployBuild = function(data){
          var deferred = $.Deferred();
          try{        
            var url = rootUrl + "/Services/" + commonData.serviceId + "/Environments/" + commonData.EnvironmentSid + "/Deployments" ;
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createAsset = function(options){ 
          var deferred = $.Deferred();
          try{                 
            var url = rootUrl + "/Services/" + options.ServiceSid + "/Assets" ;
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var createAssetVersion = function(options){    
          var deferred = $.Deferred();
          try{              
            var url = "https://serverless-upload.twilio.com/v1/Services/" + options.ServiceSid + "/Assets/" + options.AssetSid + "/Versions" ;
            var data = {"AssetSid": options.AssetSid}
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "POST",
              contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
              dataType: 'json',
              data: data
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }

        var getServicesList = function(options){ 
          var deferred = $.Deferred();
          try{         
            if(options == null || options === undefined ){
              options = {};
            }
            var accountSid = options.accountSid || commonData.accountSid;
            var authToken = options.authToken || commonData.authToken;

            var url = rootUrl + "/Services?PageSize=20";
            var options = {
              url: url, 
              headers: {"Authorization": "Basic " + btoa(accountSid + ":" + authToken)},
              type: "GET",
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: null
            }
            $.ajax(options).then(
              function(retval){
                deferred.resolve(retval);
              },
              function( jqXHR, textStatus, errorThrown){
                  deferred.reject(errorThrown);
                }
            )
          }catch(ex){
            deferred.reject(ex);
          }
          return deferred.promise();
        }
        

      
        
        var loadSavedData = function(data){
        

        if(data){
          if(data.greetingSay){
            $("#GreetingSay").val(data.greetingSay);
          }else{
            $("#GreetingSay").val('');
          }

          if(data.greetingPlay){
            $("#GreetingPlay").val(data.greetingPlay);
          }else{
            $("#GreetingPlay").val('');
          }

          if(data.huntSay){
            $("#HuntSay").val(data.huntSay);
          }else{
            $("#HuntSay").val('');
          }

          if(data.huntPlay){
            $("#HuntPlay").val(data.huntPlay);
          }else{
            $("#HuntPlay").val('');
          }


          if (data.dial && data.dial.dial1){
            setDialData(1,data.dial.dial1);
          }
          if (data.dial && data.dial.dial2){
            setDialData(2,data.dial.dial2);
          }
          if (data.dial && data.dial.dial3){
            setDialData(3,data.dial.dial3);
          }
          if (data.dial && data.dial.dial4){
            setDialData(4,data.dial.dial4);
          }
          if (data.voicemail){
            setVoicemailSettings(data.voicemail);
          }
          $("#resultJson").val(JSON.stringify(data, null, 2));
        }
      }

      var confirmDelete = function(options){

        //options = {prompt:"Are you sure you want to Delete?"}
        var $modal = $('#confirmDelete');
        var modal = bootstrap.Modal.getOrCreateInstance($modal);
        $modal.find("#prompt").text(options.prompt)
        var deferred = $.Deferred();
        $("#btnDelete").off("click").on("click",function(){
          
          modal.hide();
          deferred.resolve();
        });
        $("#btnCancel").off("click").on("click",function(){
          modal.hide();
          deferred.reject();
        });
        modal.show();
        return deferred.promise();
      }

      var confirmDialog = function(options){

        //options = {prompt:"Are you sure you want to Delete?"}
        var $modal = $('#confirmDialog');
        var modal = bootstrap.Modal.getOrCreateInstance($modal);
        $modal.find("#prompt").text(options.prompt)
        var deferred = $.Deferred();
        $("#btnConfirm").text(options.confimLabel).off("click").on("click",function(){
          modal.hide();
          deferred.resolve();
        });
        $("#btnCancel").off("click").on("click",function(){
          modal.hide();
          deferred.reject();
        });
        modal.show();
        return deferred.promise();
      }


      var clearError = function(){
        $("#ErrorDisplay").empty().hide();
      }
      var showError = function(error){

        $("#ErrorDisplay").html(error).show().focus();
      }

      var onServiceListChange = function (){
        //rebind Asset List
        var $serviceList = $("#ServiceList");
        commonData.ServiceSid = $serviceList.val();
      }
      var updateServiceVersionList = function(data){
        
        var $serviceVersionList = $("#ServiceVersionList");
        $serviceVersionList.empty();
        $.each(data, function(index, serviceVersion) {
          
          var $serviceVersion = $("<option></option>");
          $serviceVersion.attr("value",serviceVersion.commit.sha).attr("aria-controls", serviceVersion.name).text(serviceVersion.name);
          $serviceVersionList.append($serviceVersion);
        });
        
        onServiceListChange();
      }
      var updateServiceList = function(data){
        
        var $serviceList = $("#ServiceList");
        $serviceList.empty();
        $.each(data.services, function(index, service) {
          
          var $service = $("<option></option>");
          $service.attr("value",service.sid).attr("aria-controls", service.friendly_name).text(service.friendly_name);
          $serviceList.append($service);
        });
        
        onServiceListChange();
      }
      var loadJsonData = function (){
        try{
          var jsonRaw = $("#resultJson").val();
          var jsonData =  JSON.parse(jsonRaw);
          loadSavedData(jsonData);
        }catch(ex){
          showError(ex.message + "/n------------------/n" + ex.stack);
          
        }
        
      }

      var getCallFlowJson = function(){
        var jsonData = {};
        jsonData.greetingSay = $("#GreetingSay").val();
        jsonData.greetingPlay = $("#GreetingPlay").val();
        jsonData.huntSay = $("#HuntSay").val();
        jsonData.huntPlay = $("#HuntPlay").val();
        jsonData.dial = {
          dial1 : getDialData(1),
          dial2 : getDialData(2),
          dial3 : getDialData(3),
          dial4 : getDialData(4)
        };
        jsonData.voicemail = getVoicemailSettings();
        return jsonData;
      }

      var saveJsonData = function(){
        var jsonData = getCallFlowJson();
        $("#resultJson").val(JSON.stringify(jsonData, null, 2));
        sessionStorage.setItem('TwilioData', JSON.stringify(jsonData));
      }
       
      var getVoicemailSettings = function(){
        let $Voicemail = $(".Voicemail");
        var voicemailData = {};
        if( $Voicemail.find("#Enable").prop('checked')){
          voicemailData.enabled = true;
        }else{
          voicemailData.enabled = false;
        }
        
        voicemailData.say = $Voicemail.find("#Say").val();
        voicemailData.play = $Voicemail.find("#Play").val();

        if( $Voicemail.find("#PlayBeep").prop('checked')){
          voicemailData.playBeep = true;
        }else{
          voicemailData.playBeep = false;
        }
        if( $Voicemail.find("#Transcribe").prop('checked')){
          voicemailData.transcribe = true;
        }else{
          voicemailData.transcribe = false;
        }

        if( $Voicemail.find("#SmsNotify").prop('checked')){
          voicemailData.smsNotify = true;
        }else{
          voicemailData.smsNotify = false;
        }
        voicemailData.smsNotifyNumbers = $Voicemail.find("#SmsNotifyNumbers").val();

        if( $Voicemail.find("#EmailNotify").prop('checked')){
          voicemailData.emailNotify = true;
        }else{
          voicemailData.emailNotify = false;
        }
        voicemailData.emailNotifyAddresses = $Voicemail.find("#EmailNotifyAddresses").val();
        voicemailData.emailNotifySubject = $Voicemail.find("#EmailNotifySubject").val();

        return voicemailData;
      }

      var setVoicemailSettings = function(voicemailData){
        let $Voicemail = $(".Voicemail");
        
        if(voicemailData.enabled){
          $Voicemail.find("#Enable").prop('checked', true);
        }else{
          $Voicemail.find("#Enable").prop('checked', false);
        }
        
        
        if(voicemailData.say){
           $Voicemail.find("#Say").val(voicemailData.say);
        }else{
          $Voicemail.find("#Say").val("");
        }


        if(voicemailData.play){
          $Voicemail.find("#Play").val(voicemailData.play);
        }else{
          $Voicemail.find("#Play").val("");
        }

        if(voicemailData.playBeep){
          $Voicemail.find("#PlayBeep").prop('checked', true);
        }else{
          $Voicemail.find("#PlayBeep").prop('checked', false);
        }

        if(voicemailData.transcribe ){
          $Voicemail.find("#Transcribe").prop('checked',voicemailData.transcribe);
        }else{
          $Voicemail.find("#Transcribe").prop('checked',false);
        }

        if(voicemailData.smsNotify ){
          $Voicemail.find("#SmsNotify").prop('checked',voicemailData.smsNotify);
        }else{
          $Voicemail.find("#SmsNotify").prop('checked',false);
        }
        
        if(voicemailData.smsNotifyNumbers){
          $Voicemail.find("#SmsNotifyNumbers").val(voicemailData.smsNotifyNumbers);
        }else{
          $Voicemail.find("#SmsNotifyNumbers").val();
        }

        if(voicemailData.emailNotify ){
          $Voicemail.find("#EmailNotify").prop('checked',voicemailData.emailNotify);
        }else{
          $Voicemail.find("#EmailNotify").prop('checked',false)
        }
        if (voicemailData.emailNotifyAddresses){
          $Voicemail.find("#EmailNotifyAddresses").val(voicemailData.emailNotifyAddresses);
        } else{
          $Voicemail.find("#EmailNotifyAddresses").val("");
        }
        if (voicemailData.emailNotifyFrom){
          $Voicemail.find("#EmailNotifyFrom").val(voicemailData.emailNotifyFrom);
        } else{
          $Voicemail.find("#EmailNotifyFrom").val("");
        }
        if (voicemailData.emailNotifySubject){
          $Voicemail.find("#EmailNotifySubject").val(voicemailData.emailNotifySubject);
        } else{
          $Voicemail.find("#EmailNotifySubject").val("");
        }

        return voicemailData;
      }

      var getDialData = function(num){
        let $Dial = $(".Dial" + num);
        var dialData = null;
        if ($Dial.find("#Numbers").val()){
            dialData = {};
            dialData.numbers = $Dial.find("#Numbers").val();
            if($Dial.find("#Simulring").prop('checked')){
              dialData.simulring = true;
            }else{
              dialData.simulring = false;
            }
            if($Dial.find("#CallerIDUseCalled").prop('checked')){
              dialData.callerIdUseCalled = true;
            }else{
              dialData.callerIdUseCalled = false;
            }
            if($Dial.find("#Record").prop('checked')){
              dialData.record = true;
            }else{
              dialData.record = false;
            }
            if($Dial.find("#RecordSmsNotify").prop('checked')){
              dialData.recordSmsNotify = true;
            }else{
              dialData.recordSmsNotify = false;
            }
            if($Dial.find("#SmsNotifyCalled").prop('checked')){
              dialData.smsNotifyCalled = true;
            }else{
              dialData.smsNotifyCalled = false;
            }
            
            
            if($Dial.find("#Transcibe").prop('checked')){
              dialData.transcibe = true;
            }else{
              dialData.transcibe = false;
            }
            if($Dial.find("#TranscribeSmsNotify").prop('checked')){
              dialData.transcibeSmsNotify = true;
            }else{
              dialData.transcibeSmsNotify = false;
            }
            if($Dial.find("#TranscribeSmsNotifyCalled").prop('checked')){
              dialData.transcibeSmsNotifyCalled = true;
            }else{
              dialData.transcibeSmsNotifyCalled = false;
            }


            if($Dial.find("#smsNotifyNumbers").val()){
              dialData.smsNotifyNumbers = $Dial.find("#smsNotifyNumbers").val();
            }else{
              dialData.smsNotifyNumbers ="";
            }

            if($Dial.find("#smsNotifyTitle").val()){
              dialData.smsNotifyTitle = $Dial.find("#smsNotifyTitle").val();
            }else{
              dialData.smsNotifyTitle ="";
            }
            
        }
        return dialData;
      }

      var setDialData = function(num, dialData){
        let $Dial = $(".Dial" + num);
        if(dialData.numbers){
          $Dial.find("#Numbers").val(dialData.numbers);
        }else{
          $Dial.find("#Numbers").val("");
        }
        if(dialData.simulring){
          $Dial.find("#Simulring").prop('checked',"checked");
        }else{
          $Dial.find("#Simulring").prop('checked',"");
        }
        if(dialData.callerIdUseCalled){
          $Dial.find("#CallerIdUseCalled").prop('checked',"checked");
        }else{
          $Dial.find("#CallerIdUseCalled").prop('checked',"");
        }
        if(dialData.record){
          $Dial.find("#Record").prop('checked',"checked");
        }else{
          $Dial.find("#Record").prop('checked',"");
        }
        if(dialData.recordSmsNotify){
          $Dial.find("#RecordSmsNotify").prop('checked',"checked");
        }else{
          $Dial.find("#RecordSmsNotify").prop('checked',"");
        }
        if(dialData.smsNotifyCalled){
          $Dial.find("#smsNotifyCalled").prop('checked',"checked");
        }else{
          $Dial.find("#smsNotifyCalled").prop('checked',"");
        }
        
        if(dialData.smsNotifyNumbers){
          $Dial.find("#smsNotifyNumbers").val(dialData.smsNotifyNumbers);
        }else{
          $Dial.find("#smsNotifyTitle").val("");
        }
        
        if(dialData.smsNotifyTitle){
          $Dial.find("#smsNotifyTitle").val(dialData.smsNotifyTitle);
        }else{
          $Dial.find("#smsNotifyTitle").val("");
        }


        if(dialData.transcibe){
          $Dial.find("#Transcibe").prop('checked',"checked");
        }else{
          $Dial.find("#Transcibe").prop('checked',"");
        }
        if(dialData.transcibeSmsNotify){
          $Dial.find("#TranscribeSmsNotify").prop('checked',"checked");
        }else{
          $Dial.find("#TranscribeSmsNotify").prop('checked',"");
        }
        if(dialData.transcibeSmsNotifyCalled){
          $Dial.find("#TranscribeSmsNotifyCalled").prop('checked',"checked");
        }else{
          $Dial.find("#TranscribeSmsNotifyCalled").prop('checked',"");
        }
      }

      var init = function(){
        clearError();
        //inject 4 Dial Templates
        var $DialTemplate = $("#templates").find(".Dial");
        var $DialContainer = $(".DialContainer");
        for(let i=1; i <= 4; i++){
          var $Dial = $DialTemplate.clone();
          $Dial.removeClass("Dial").addClass("Dial" + i);
          $DialContainer.append($Dial);
        }

        
        //$("#btnSave").on("click", saveJsonData);

        //$("#btnLoad").on("click", loadJsonData);
        $("#btnServiceDelete").on("click", 
          function(){
            clearError();
            var confirmData = {prompt:"Are you sure you want to Delete this Service?"}
            confirmDelete(confirmData).then(
              function(){
                //they Clicked Delete
                var $serviceList = $("#ServiceList");
                var data = {ServiceSid : $serviceList.val()};
                deleteService(data).then(
                  function(){
                    getServicesList().then(
                      function(services){
                        updateServiceList(services);
                      },
                      function(error){
                        var msg = error.message || error.statusText
                        showError(msg)
                      } 
                    )
                  },
                  function(error){
                    var msg = error.message || error.statusText
                    showError(msg)
                  } 
                )
              },
              function(){
                //do nothing here they clicked Cancel
              }
            );
          }
        );


        $("#btnTest").on("click", 
          function(){
            clearError();
            var options = {sha: $("#ServiceVersionList").val()}
            getRepoFunctionList(options).then(
              function(functionList){
                console.log(functionList);
              },
              function(error){
                var msg = error.message || error.statusText
                showError(msg)
              } 
            )    
          }
        );


        $("#btnServiceUpgrade").on("click", 
          function(){
            clearError();
            var confirmData = {prompt:"Are you sure you want to Upgrade/Install this Service?", confirmText: "Upgrade"}
            confirmDialog(confirmData).then(
              function(){
                //they Clicked Confirm
                var $serviceList = $("#ServiceList");
                var data = {ServiceSid : $serviceList.val(), repoVersionSha: $("#ServiceVersionList").val() };
                upgradeService(data).then(
                  function(){
                    getServicesList().then(
                      function(services){
                        updateServiceList(services);
                      },
                      function(error){
                        var msg = error.message || error.statusText
                        showError(msg)
                      } 
                    )
                  },
                  function(error){
                    var msg = error.message || error.statusText
                    showError(msg)
                  } 
                )
              },
              function(){
                //do nothing here they clicked Cancel
              }
            );
          }
        );
        
        $("#ServiceList").on("change", onServiceListChange)

        $('#assetNew').find(".btnCreateAsset").on("click", function(event){
          var $modal = $('#assetNew');
          var modal = bootstrap.Modal.getOrCreateInstance($modal);
          var data = {
            FriendlyName: $modal.find("#FriendlyName").val()
          }
          createAsset(data).then(
            function(newAsset){
              var newAssetVersionData = { 
                Path: $modal.find("#Path").val(),
                AssetSid : newAsset.sid,
                Visibility : "private",
                Content : JSON.stringify(getCallFlowJson())
              }
              // createAssetVersion(newAssetVersionData).then(
              //   function(newAssetVersion){
                  getAssetList().then(
                    function(assetList){

                      updateServiceList(services);
                      modal.hide();
                    },
                    function(error){
                      commonData.isValidAccount = false;
                      var msg = error.message || error.statusText
                      $modal.find("#NewAssetError").html(msg).show().focus();
                    }
                  ) 
              //   },
              //   function(error){
              //     commonData.isValidAccount = false;
              //     var msg = error.message || error.statusText
              //     $modal.find("#NewAssetError").html(msg).show().focus();
              //   }

              // )
               
            },
            function(error){
              commonData.isValidAccount = false;
              var msg = error.message || error.statusText
              $modal.find("#NewServiceError").html(msg).show().focus();
            }

          )

        })
        
        $('#serviceNew').find(".btnCreateService").on("click", function(event){
          var $modal = $('#serviceNew');
          var modal = bootstrap.Modal.getOrCreateInstance($modal);
          
          var isUiEditableChecked = $modal.find("#UiEditable").prop("checked");
          var data = {
            UniqueName : $modal.find("#UniqueName").val(),
            FriendlyName: $modal.find("#FriendlyName").val(),
            UiEditable: isUiEditableChecked,
            IncludeCredentials: true
          }
          createService(data).then(
            function(newService){
              commonData.ServiceSid = newService.sid;
              createEnvironment({ServiceSid:newService.sid, UniqueName:"prod"}).then(
                function(environmentData){
                  commonData.enviromentSid = environmentData.sid;
                  getServicesList().then(
                    function(services){
                      
                      updateServiceList(services);
                      modal.hide();
                    },
                    function(error){
                      commonData.isValidAccount = false;
                      var msg = error.message || error.statusText
                      $modal.find("#NewServiceError").html(msg).show().focus();
                    }
                  )
                },
                function(error){
                  commonData.isValidAccount = false;
                  var msg = error.message || error.statusText
                  $modal.find("#NewServiceError").html(msg).show().focus();
                }

              )
                
            },
            function(error){
              commonData.isValidAccount = false;
              var msg = error.message || error.statusText
              $modal.find("#NewServiceError").html(msg).show().focus();
            }

          )

        })

        $('#login').find(".btnLogin").on("click", function(event){
          var $modal = $('#login');
          var modal = bootstrap.Modal.getOrCreateInstance($modal);
          var loginOptions = {
            accountSid : $modal.find("#AccountSID").val(),
            authToken : $modal.find("#AuthToken").val()
          }
          var ischecked = $modal.find("#AuthTokenSave").prop("checked");
          if(ischecked === false){
            sessionStorage.removeItem('AccountSID');
            sessionStorage.removeItem('AuthToken');
          }
          getServicesList(loginOptions).then(
            function(data){
                commonData.isValidAccount = true;
                //Successfull login so update Credentials
                commonData.accountSid = $modal.find("#AccountSID").val();
                commonData.authToken = $modal.find("#AuthToken").val();
                var ischecked = $modal.find("#AuthTokenSave").prop("checked");
                if(ischecked){
                  sessionStorage.setItem('AccountSID',  $modal.find("#AccountSID").val())
                  sessionStorage.setItem('AuthToken',  $modal.find("#AuthToken").val())
                }else{
                  sessionStorage.removeItem('AccountSID');
                  sessionStorage.removeItem('AuthToken');
                }
                updateServiceList(data);
                modal.hide();
            },
            function(error){
              commonData.isValidAccount = false;
              var msg = error.message || error.statusText
              $modal.find("#assetOpenError").html(msg).show().focus();
            }

          )

        })


        
        $('#assetOpen').find(".btnOpen").on("click", function(event){
          var $modal = $('#assetOpen');
          var modal = bootstrap.Modal.getOrCreateInstance($modal)
          var $selected = $modal.find(".assetList").find(".asset.active");
          if($selected.length > 0 && $selected.attr("data-sid") != ""){
            var selectedAsset = $selected.attr("data-sid");
            var asset = $selected.data();
            console.log(asset);
            var getOptions = {
              url: asset.url, 
              headers: {"Authorization": "Basic " + btoa(commonData.accountSid + ":" + commonData.authToken)},
              type: "GET",
              data: null
            }
            $.get(getOptions).then(
              function(data){

              },
              function(error){
                var msg = error.message || error.statusText
                $modal.find("#assetOpenError").html(msg).show().focus();
              }
            )
          }else{
            var msg = "Please Select a Asset to Load";
              $modal.find("#assetOpenError").html(msg).show().focus();
          }

        })
        $('#assetOpen').on('show.bs.modal', function (event) {
          var $modal = $(this);
          
          $modal.find("#assetOpenError").html("").hide();
          getAssetsList().then(
            function(data){
                var $assetTemplate = $("#templates").find(".assetListTemplate").find(".asset");
                var $assetList = $modal.find(".assetList");
                $assetList.empty();
                $.each(data.assets, function(index, asset) {
                  
                  var $asset = $assetTemplate.clone();
                  $asset.data(asset)
                  $asset.attr("data-sid",asset.sid).attr("aria-controls", asset.friendly_name).text(asset.friendly_name);
                  $assetList.append($asset);
                });
                $assetList.find(".asset").on("click", function(evt){
                  $assetList.find(".asset").removeClass("active");
                  $(evt.currentTarget).addClass("active");
                });

                
            },
            function(error){
              var msg = error.message || error.statusText
              $modal.find("#assetOpenError").html(msg).show().focus();
            }

          )
          
        })


        $('#assetSave').find(".btnSave").on("click", function(event){
          var $modal = $('#assetSave');
          var modal = bootstrap.Modal.getOrCreateInstance($modal)
          var $selected = $modal.find(".assetList").find(".asset.active");
          if($selected.length > 0 && $selected.attr("data-sid") != ""){
            var selectedAsset = $selected.attr("data-sid");
            var asset = $selected.data();
            var newAssetVersionData = { 
                Path: $modal.find("#Path").val(),
                AssetSid : asset.sid,
                //ServiceSid : asset.service_sid,
                Visibility : "protected",
                Content : JSON.stringify(getCallFlowJson())
              }
            createAssetVersion(newAssetVersionData).then(
              function(data){

              },
              function(error){
                var msg = error.message || error.statusText
                $modal.find("#assetOpenError").html(msg).show().focus();
              }
            )
          }else{
            var msg = "Please Select a Asset to Load";
              $modal.find("#assetOpenError").html(msg).show().focus();
          }

        })

        $('#assetSave').on('show.bs.modal', function (event) {
          var $modal = $(this);
          
          $modal.find("#assetSaveError").html("").hide();
          getAssetsList().then(
            function(data){
                var $assetTemplate = $("#templates").find(".assetListTemplate").find(".asset");
                var $assetList = $modal.find(".assetList");
                $assetList.empty();
                $.each(data.assets, function(index, asset) {
                  var $asset = $assetTemplate.clone();
                  $asset.data(asset)
                  $asset.attr("data-sid",asset.sid).attr("aria-controls", asset.friendly_name).text(asset.friendly_name);
                  $assetList.append($asset);
                });
                $assetList.find(".asset").on("click", function(evt){
                  $assetList.find(".asset").removeClass("active");
                  $(evt.currentTarget).addClass("active");
                });

                
            },
            function(error){
              var msg = error.message || error.statusText
              $modal.find("#assetOpenError").html(msg).show().focus();
            }

          )
          
        })

        try{
          let savedAccountSID = sessionStorage.getItem('AccountSID');
          let savedAuthToken = sessionStorage.getItem('AuthToken');
          if(savedAccountSID || savedAuthToken){
            commonData.accountSid = savedAccountSID;
            commonData.authToken = savedAuthToken;
            $("#AccountSID").val(savedAccountSID);
            $("#AuthToken").val(savedAuthToken);
            $("#AuthTokenSave").prop("checked", "checked");
          }
          //let savedAuthToken = sessionStorage.getItem('AuthToken');
          if(savedAccountSID && savedAuthToken){
            getServicesList().then(
              function(data){
                updateServiceList(data);
                commonData.isValidAccount = true;  
              },
              function(err){
                commonData.isValidAccount = false;
              }
            )
          }
          getRepoTags().then(
            function(data){
              updateServiceVersionList(data);
            },
            function(err){
              var msg = err.message || err.msg || err;
              var stack = err.stack || ""
              showError(msg + "/n------------------/n" + stack);
            }
          )
          let savedData = sessionStorage.getItem('TwilioData');
          if(savedData){
            parsedData = JSON.parse(savedData);
            loadSavedData(parsedData);
            
          }
        }catch(ex){
          showError(ex.message + "/n------------------/n" + ex.stack);
        }


      }


      init();
      })
    </script>
  </head>
  <body>
      <div class="container">
        <div class="float-end">
          <div class="btn-group" role="group" aria-label="Load Save">
            
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" title="Open New Asset" data-bs-target="#assetOpen">Open</button>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" title="Login to Twilio" data-bs-target="#login">Login</button>
          </div>
        </div>
        <div>
          <h1>Flow Asset Generator</h1>
          
          <span>Save Created Json as an Asset (SampleCallFlow.json) and then call the flow using the ExecuteFlow function like this ExecuteFlow?Flow=%2FSampleCallFlow.json</span>
        </div>
        
        <div class="mb-3">
          <div class="row">
            <div class="col">
              <label for="ServiceList" class="form-label">Service</label>
              <select id="ServiceList" class="form-select" aria-label="Select Service"></select>
            </div>
          </div>
          <div class="row align-items-left">
            <div class="col">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#serviceNew">New</button>
            </div>
            <div class="col">
              <button type="button" class="btn btn-secondary" id="btnServiceDelete"  >Delete</button>
            </div>
            <div class="col">
              <button type="button" class="btn btn-secondary" id="btnServiceUpgrade">Upgrade</button>
            </div>
            <div class="col">
              <button type="button" class="btn btn-secondary" id="btnTest">Test</button>
            </div>
            <div class="col">
              <label for="ServiceList" class="form-label">Version</label>
              <select id="ServiceVersionList" class="form-select" aria-label="Select Version"></select>
            </div>
          </div>
        </div>
        
        
        <div class="mb-3">
          <label for="GreetingSay" class="form-label">Greeting Say</label>
          <input type="text" class="form-control" id="GreetingSay" placeholder="Thank you for Calling. Please wait while we locate an Agent. Call may be Recorded for Training Purposes." value="">
        </div>
        <div class="mb-3">
          <label for="GreetingPlay" class="form-label">Greeting Play</label>
          <input type="text" class="form-control" id="GreetingPlay" placeholder="http://example.com/sample.mp3">
        </div>

        <div class="mb-3">
          <label for="HuntSay" class="form-label">Hunt Say</label>
          <input type="text" class="form-control" id="HuntSay" placeholder="Please wait while we locate an Agent." value="">
        </div>
        <div class="mb-3">
          <label for="HuntPlay" class="form-label">Hunt Play</label>
          <input type="text" class="form-control" id="HuntPlay" placeholder="http://example.com/sample.mp3">
        </div>
        
        <div class="mb-3">
          <label class="form-label">Numbers to Call (numbers can be +15555551212 or sip:+15555551212@example.com seperated by commas)</label>
          <div class="DialContainer">
          </div>
        </div>
        
        <div class="mb-3">
          <div class="Voicemail">
            <div class="card">
              <div class="card-body">
                <label class="form-label">Voicemail</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="Enable">
                  <label class="form-check-label" for="Enable">
                    Enable Voicemail if No Answer
                  </label>
                </div>
                <div class="mb-3">
                  <label for="Say" class="form-label">Say</label>
                  <input type="text" class="form-control" id="Say" placeholder="Please Leave a Message." value="">
                </div>
                <div class="mb-3">
                  <label for="Play" class="form-label">Play</label>
                  <input type="text" class="form-control" id="Play" placeholder="http://example.com/sample.mp3">
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="PlayBeep">
                  <label class="form-check-label" for="PlayBeep">
                    Voicemail PlayBeep
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="Transcribe">
                  <label class="form-check-label" for="Transcribe">
                    Voicemail Transcribe
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="SmsNotify">
                  <label class="form-check-label" for="SmsNotify">
                    Voicemail Send SMS
                  </label>
                </div>
                <div class="mb-3">
                  <label for="SmsNotifyNumbers" class="form-label">SMS Notify Numbers</label>
                  <input type="text" class="form-control" id="SmsNotifyNumbers" placeholder="+15555551212">
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="EmailNotify">
                  <label class="form-check-label" for="EmailNotify">Voicemail Send Email</label>
                </div>
                <div class="mb-3">
                  <label for="EmailNotifyAddresses" class="form-label">Email Address</label>
                  <input type="text" class="form-control" id="EmailNotifyAddresses" placeholder="john@example.com, joe@example.com">
                </div>
                <div class="mb-3">
                  <label for="EmailNotifyFrom" class="form-label">Email From Address</label>
                  <input type="email" class="form-control" id="EmailNotifyFrom" placeholder="john@example.com">
                </div>
                <div class="mb-3">
                  <label for="EmailNotifySubject" class="form-label">Email Subject</label>
                  <input type="text" class="form-control" id="EmailNotifySubject" placeholder="Voicemail Message">
                </div>
              </div>
            </div>
          </div>
        </div>  
        <div class="mb-3">
          <div class="btn-group" role="group" aria-label="Save">
            <button class="btn btn-primary" title="Save Asset" data-bs-toggle="modal" data-bs-target="#assetSave" >Save</button>
          </div>
        </div>
        
        <div class="mb-3">
          <div id="ErrorDisplay" class="alert alert-danger hidden" role="alert">
          </div>
        </div>
        <div class="mb-3">
          <div>
            <textarea id="resultJson" class="form-control" style="min-width: 100%; min-height: 300px;"></textarea>
          </div>
        </div>
      </div>
      
      <div class="modal fade" id="confirmDelete" tabindex="-1" role="dialog" aria-labelledby="confirmDelete" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirm Delete</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <h3 id="prompt"></h3>
                
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" id="btnDelete" class="btn btn-primary">Delete</button>
              <button type="button" id="btnCancel" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="confirmDialog" tabindex="-1" role="dialog" aria-labelledby="confirmDialog" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirm</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <h3 id="prompt"></h3>
                
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" id="btnConfirm" class="btn btn-primary">Confirm</button>
              <button type="button" id="btnCancel" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="assetOpen" tabindex="-1" role="dialog" aria-labelledby="assetOpen" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Open Asset</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <label class="label">Asset Name</label>
              <ul class="list-group assetList" role="tablist">
                
                
              </ul>
              <div class="mb-3">
                <div id="assetOpenError" class="alert alert-danger hidden" style="display: none;" role="alert">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" title="Create New Asset" data-bs-target="#assetNew">New</button>
              <button type="button" class="btn btn-primary btnOpen">Open</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="assetSave" tabindex="-1" role="dialog" aria-labelledby="assetSave" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Save Asset</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <label class="label">Asset Name</label>
              <ul class="list-group assetList" role="tablist">
                
                
              </ul>
              <div class="mb-3">
                <div id="assetSaveError" class="alert alert-danger hidden" style="display: none;" role="alert">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" title="Create New Asset" data-bs-target="#assetNew">New</button>
              <button type="button" class="btn btn-primary btnSaveAsset">Save</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>


      <div class="modal fade" id="assetNew" tabindex="-1" role="dialog" aria-labelledby="assetNew" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">New Asset</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="FriendlyName" class="form-label">Friendly Name</label>
                <input type="text" class="form-control" id="FriendlyName" placeholder="Friendly Name" value="">
              </div>
              <div class="mb-3">
                <label for="Path" class="form-label">Path</label>
                <input type="text" class="form-control" id="Path" placeholder="/DefaultFlow.json" value="/DefaultFlow.json">
              </div>
              <div class="mb-3">
                <div id="assetNewError" class="alert alert-danger hidden" style="display: none;" role="alert">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary btnCreateAsset">Create</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="login" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Login</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="AccountSID" class="form-label">Account SID</label>
                <input type="text" class="form-control" id="AccountSID" placeholder="Account SID" value="">
              </div>
              <div class="mb-3">
                <label for="AuthToken" class="form-label">Auth Token</label>
                <input type="text" class="form-control" id="AuthToken" placeholder="Auth Token." value="">
              </div>
              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="AuthTokenSave" value="">
                <label for="AuthTokenSave" class="form-check-label">Save Credentials</label>
              </div>
              <div class="mb-3">
                <div id="loginError" class="alert alert-danger" style="display: none;" role="alert">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary btnLogin">Login</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>


      <div class="modal fade" id="serviceNew" tabindex="-1" role="dialog" aria-labelledby="serviceNew" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">New Service</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="UniqueName" class="form-label">Unique Name</label>
                <input type="text" class="form-control" id="UniqueName" placeholder="Unique Name" value="">
              </div>
              <div class="mb-3">
                <label for="FriendlyName" class="form-label">Friendly Name</label>
                <input type="text" class="form-control" id="FriendlyName" placeholder="Friendly Name" value="">
              </div>
              <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="UiEditable" value="" checked="checked">
                <label for="UiEditable" class="form-check-label">UI Editable</label>
              </div>
              <div class="mb-3">
                <div id="NewServiceError" class="alert alert-danger" style="display: none;" role="alert">
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary btnCreateService">Create Service</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>


      <div class="hidden" id="templates" style="display:none" >
        <select class="serviceListTemplate">
          <option selected>Open this select menu</option>
          
        </select>

        <ul class="assetListTemplate">
          
          <li class="list-group-item asset" data-name="" role="tab" aria-controls="assetTemplate">Template</li>
        </ul>


        <div class="Dial">
          <div class="card">
            <div class="card-body">
              <div class="input-group">
                <label for="Numbers" class="form-label">Numbers</label>
                <input type="text" class="form-control" id="Numbers" placeholder="+15555551212">
              </div>
              <div class="input-group">
                <label for="DialTimeout" class="form-label">Answer Timeout</label>
                <input type="text" class="form-control" id="CallTimeout" placeholder="5">
                <label for="DialTimelimit" class="form-label">Call Timelimit</label>
                <input type="text" class="form-control" id="DialTimelimit" placeholder="3600">
                <label for="DialRecordTrim" class="form-label">Record Trim</label>
                <select type="text" class="form-control" id="DialTimelimit">
                  <option value="trim-silence">trim-silence</option>
                  <option value="trim-silence">do-not-trim</option>
                </select>
              </div>
              <div class="input-group">
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="Simulring">
                  <label class="form-check-label" for="Simulring">
                    Simulring <i class="bi bi-question-circle" title="Ring all numbers at same time"></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="CallerIdUseCalled">
                  <label class="form-check-label" for="CallerIdUseCalled">
                     Caller ID Use Called <i class="bi bi-question-circle" title="Outbound Caller ID will be set to Called number to Alert Answerer that is a forwarded call"></i>
                  </label>
                </div>
              </div>
              <div class="input-group">
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="Record">
                  <label class="form-check-label" for="Record">
                    Record Call
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="RecordSmsNotify">
                  <label class="form-check-label" for="RecordSmsNotify">
                    Record Send SMS <i class="bi bi-question-circle" title="Send SMS to the SMS Notify Numbers and/or Number that Answered"></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="SmsNotifyCalled">
                  <label class="form-check-label" for="SmsNotifyCalled">
                    Record Send SMS To Called <i class="bi bi-question-circle" title="Send SMS to the number that was called and answered this call"></i>
                  </label>
                </div>
                
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="Transcibe">
                  <label class="form-check-label" for="Transcribe">
                    Transcribe <i class="bi bi-question-circle" title="Transcribe Answered Call"></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="TranscibeSmsNotify">
                  <label class="form-check-label" for="TranscribeSmsNotify">
                    Transcribe Send SMS <i class="bi bi-question-circle" title="Send a SMS with Transcribed Message to Notify Numbers "></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="TranscibeSmsNotify">
                  <label class="form-check-label" for="TranscribeSmsNotify">
                    Transcribe Send SMS Called <i class="bi bi-question-circle" title="Send a SMS with Transcribed Message to Called and Answered Number "></i>
                  </label>
                </div>
              </div>
              <div>
                <label for="SmsNotifyNumbers" class="form-label">Sms Notify Numbers</label>
                <input type="text" class="form-control" id="SmsNotifyNumbers" placeholder="+15555551212">
              </div>
              <div>
                <label for="SmsNotifyTitle" class="form-label">Sms Notify Title</label>
                <input type="text" class="form-control" id="SmsNotifyTitle" placeholder="Call Recorded">
              </div>
            </div>
          </div>
        </div>
        
      </div>

      
  </body>
</html>
