<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Twilio Incoming Call Flow Generator</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
    
    
    <script>

      


      $(function(){

      
        let rootUrl = "/Main?"
        var loadSavedData = function(data){
        if(data){
          if(data.greetingSay){
            $("#GreetingSay").val(data.greetingSay);
          }else{
            $("#GreetingSay").val('');
          }

          if(data.greetingPlay){
            $("#GreetingPlay").val(data.greetingPlay);
          }else{
            $("#GreetingPlay").val('');
          }

          if(data.huntSay){
            $("#HuntSay").val(data.huntSay);
          }else{
            $("#HuntSay").val('');
          }

          if(data.huntPlay){
            $("#HuntPlay").val(data.huntPlay);
          }else{
            $("#HuntPlay").val('');
          }


          if (data.dial && data.dial.dial1){
            setDialData(1,data.dial.dial1);
          }
          if (data.dial && data.dial.dial2){
            setDialData(2,data.dial.dial2);
          }
          if (data.dial && data.dial.dial3){
            setDialData(3,data.dial.dial3);
          }
          if (data.dial && data.dial.dial4){
            setDialData(4,data.dial.dial4);
          }
          if (data.voicemail){
            setVoicemailSettings(data.voicemail);
          }
          $("#resultJson").val(JSON.stringify(data, null, 2));
        }
      }

      var clearError = function(){
        $("#ErrorDisplay").empty().hide();
      }

      
      var showError = function(error){

        $("#ErrorDisplay").html(error).show().focus();
      }

      var loadJsonData = function (){
        try{
          var jsonRaw = $("#resultJson").val();
          var jsonData =  JSON.parse(jsonRaw);
          loadSavedData(jsonData);
        }catch(ex){
          showError(ex.message + "/n------------------/n" + ex.stack);
          
        }
        
      }

      var saveJsonData = function(){
        var jsonData = {};
        jsonData.greetingSay = $("#GreetingSay").val();
        jsonData.greetingPlay = $("#GreetingPlay").val();
        jsonData.huntSay = $("#HuntSay").val();
        jsonData.huntPlay = $("#HuntPlay").val();
        jsonData.dial = {
          dial1 : getDialData(1),
          dial2 : getDialData(2),
          dial3 : getDialData(3),
          dial4 : getDialData(4)
        };
        jsonData.voicemail = getVoicemailSettings();
        $("#resultJson").val(JSON.stringify(jsonData, null, 2));
        sessionStorage.setItem('TwilioData', JSON.stringify(jsonData));
      }
       
      var getVoicemailSettings = function(){
        let $Voicemail = $(".Voicemail");
        var voicemailData = {};
        if( $Voicemail.find("#Enable").prop('checked')){
          voicemailData.enabled = true;
        }else{
          voicemailData.enabled = false;
        }
        
        voicemailData.say = $Voicemail.find("#Say").val();
        voicemailData.play = $Voicemail.find("#Play").val();

        if( $Voicemail.find("#PlayBeep").prop('checked')){
          voicemailData.playBeep = true;
        }else{
          voicemailData.playBeep = false;
        }
        if( $Voicemail.find("#Transcribe").prop('checked')){
          voicemailData.transcribe = true;
        }else{
          voicemailData.transcribe = false;
        }

        if( $Voicemail.find("#SmsNotify").prop('checked')){
          voicemailData.smsNotify = true;
        }else{
          voicemailData.smsNotify = false;
        }
        voicemailData.smsNotifyNumbers = $Voicemail.find("#SmsNotifyNumbers").val();

        if( $Voicemail.find("#EmailNotify").prop('checked')){
          voicemailData.emailNotify = true;
        }else{
          voicemailData.emailNotify = false;
        }
        voicemailData.emailNotifyAddresses = $Voicemail.find("#EmailNotifyAddresses").val();
        voicemailData.emailNotifySubject = $Voicemail.find("#EmailNotifySubject").val();

        return voicemailData;
      }

      var setVoicemailSettings = function(voicemailData){
        let $Voicemail = $(".Voicemail");
        
        if(voicemailData.enabled){
          $Voicemail.find("#Enable").prop('checked', true);
        }else{
          $Voicemail.find("#Enable").prop('checked', false);
        }
        
        
        if(voicemailData.say){
           $Voicemail.find("#Say").val(voicemailData.say);
        }else{
          $Voicemail.find("#Say").val("");
        }


        if(voicemailData.play){
          $Voicemail.find("#Play").val(voicemailData.play);
        }else{
          $Voicemail.find("#Play").val("");
        }

        if(voicemailData.playBeep){
          $Voicemail.find("#PlayBeep").prop('checked', true);
        }else{
          $Voicemail.find("#PlayBeep").prop('checked', false);
        }

        if(voicemailData.transcribe ){
          $Voicemail.find("#Transcribe").prop('checked',voicemailData.transcribe);
        }else{
          $Voicemail.find("#Transcribe").prop('checked',false);
        }

        if(voicemailData.smsNotify ){
          $Voicemail.find("#SmsNotify").prop('checked',voicemailData.smsNotify);
        }else{
          $Voicemail.find("#SmsNotify").prop('checked',false);
        }
        
        if(voicemailData.smsNotifyNumbers){
          $Voicemail.find("#SmsNotifyNumbers").val(voicemailData.smsNotifyNumbers);
        }else{
          $Voicemail.find("#SmsNotifyNumbers").val();
        }

        if(voicemailData.emailNotify ){
          $Voicemail.find("#EmailNotify").prop('checked',voicemailData.emailNotify);
        }else{
          $Voicemail.find("#EmailNotify").prop('checked',false)
        }
        if (voicemailData.emailNotifyAddresses){
          $Voicemail.find("#EmailNotifyAddresses").val(voicemailData.emailNotifyAddresses);
        } else{
          $Voicemail.find("#EmailNotifyAddresses").val("");
        }
        if (voicemailData.emailNotifyFrom){
          $Voicemail.find("#EmailNotifyFrom").val(voicemailData.emailNotifyFrom);
        } else{
          $Voicemail.find("#EmailNotifyFrom").val("");
        }
        if (voicemailData.emailNotifySubject){
          $Voicemail.find("#EmailNotifySubject").val(voicemailData.emailNotifySubject);
        } else{
          $Voicemail.find("#EmailNotifySubject").val("");
        }

        return voicemailData;
      }

      var getDialData = function(num){
        let $Dial = $(".Dial" + num);
        var dialData = null;
        if ($Dial.find("#Numbers").val()){
            dialData = {};
            dialData.numbers = $Dial.find("#Numbers").val();
            if($Dial.find("#Simulring").prop('checked')){
              dialData.simulring = true;
            }else{
              dialData.simulring = false;
            }
            if($Dial.find("#CallerIDUseCalled").prop('checked')){
              dialData.callerIdUseCalled = true;
            }else{
              dialData.callerIdUseCalled = false;
            }
            if($Dial.find("#Record").prop('checked')){
              dialData.record = true;
            }else{
              dialData.record = false;
            }
            if($Dial.find("#RecordSmsNotify").prop('checked')){
              dialData.recordSmsNotify = true;
            }else{
              dialData.recordSmsNotify = false;
            }
            if($Dial.find("#SmsNotifyCalled").prop('checked')){
              dialData.smsNotifyCalled = true;
            }else{
              dialData.smsNotifyCalled = false;
            }
            
            
            if($Dial.find("#Transcibe").prop('checked')){
              dialData.transcibe = true;
            }else{
              dialData.transcibe = false;
            }
            if($Dial.find("#TranscribeSmsNotify").prop('checked')){
              dialData.transcibeSmsNotify = true;
            }else{
              dialData.transcibeSmsNotify = false;
            }
            if($Dial.find("#TranscribeSmsNotifyCalled").prop('checked')){
              dialData.transcibeSmsNotifyCalled = true;
            }else{
              dialData.transcibeSmsNotifyCalled = false;
            }


            if($Dial.find("#smsNotifyNumbers").val()){
              dialData.smsNotifyNumbers = $Dial.find("#smsNotifyNumbers").val();
            }else{
              dialData.smsNotifyNumbers ="";
            }

            if($Dial.find("#smsNotifyTitle").val()){
              dialData.smsNotifyTitle = $Dial.find("#smsNotifyTitle").val();
            }else{
              dialData.smsNotifyTitle ="";
            }
            
        }
        return dialData;
      }

      var setDialData = function(num, dialData){
        let $Dial = $(".Dial" + num);
        if(dialData.numbers){
          $Dial.find("#Numbers").val(dialData.numbers);
        }else{
          $Dial.find("#Numbers").val("");
        }
        if(dialData.simulring){
          $Dial.find("#Simulring").prop('checked',"checked");
        }else{
          $Dial.find("#Simulring").prop('checked',"");
        }
        if(dialData.callerIdUseCalled){
          $Dial.find("#CallerIdUseCalled").prop('checked',"checked");
        }else{
          $Dial.find("#CallerIdUseCalled").prop('checked',"");
        }
        if(dialData.record){
          $Dial.find("#Record").prop('checked',"checked");
        }else{
          $Dial.find("#Record").prop('checked',"");
        }
        if(dialData.recordSmsNotify){
          $Dial.find("#RecordSmsNotify").prop('checked',"checked");
        }else{
          $Dial.find("#RecordSmsNotify").prop('checked',"");
        }
        if(dialData.smsNotifyCalled){
          $Dial.find("#smsNotifyCalled").prop('checked',"checked");
        }else{
          $Dial.find("#smsNotifyCalled").prop('checked',"");
        }
        
        if(dialData.smsNotifyNumbers){
          $Dial.find("#smsNotifyNumbers").val(dialData.smsNotifyNumbers);
        }else{
          $Dial.find("#smsNotifyTitle").val("");
        }
        
        if(dialData.smsNotifyTitle){
          $Dial.find("#smsNotifyTitle").val(dialData.smsNotifyTitle);
        }else{
          $Dial.find("#smsNotifyTitle").val("");
        }


        if(dialData.transcibe){
          $Dial.find("#Transcibe").prop('checked',"checked");
        }else{
          $Dial.find("#Transcibe").prop('checked',"");
        }
        if(dialData.transcibeSmsNotify){
          $Dial.find("#TranscribeSmsNotify").prop('checked',"checked");
        }else{
          $Dial.find("#TranscribeSmsNotify").prop('checked',"");
        }
        if(dialData.transcibeSmsNotifyCalled){
          $Dial.find("#TranscribeSmsNotifyCalled").prop('checked',"checked");
        }else{
          $Dial.find("#TranscribeSmsNotifyCalled").prop('checked',"");
        }
      }

      var init = function(){
        clearError();
        //inject 4 Dial Templates
        var $DialTemplate = $("#templates").find(".Dial");
        var $DialContainer = $(".DialContainer");
        for(let i=1; i <= 4; i++){
          var $Dial = $DialTemplate.clone();
          $Dial.removeClass("Dial").addClass("Dial" + i);
          $DialContainer.append($Dial);
        }

        
        $("#btnSave").on("click", saveJsonData);

        $("#btnLoad").on("click", loadJsonData)


        try{
          let savedData = sessionStorage.getItem('TwilioData');
          if(savedData){
            parsedData = JSON.parse(savedData);
            loadSavedData(parsedData);
            
          }
        }catch(ex){
          showError(ex.message + "/n------------------/n" + ex.stack);
        }


      }


      init();
      })
    </script>
  </head>
  <body>
      <div class="container">
        <div>
          <h1>Flow Asset Generator</h1>
          <span>Save Created Json as an Asset (SampleCallFlow.json) and then call the flow using the ExecuteFlow function like this ExecuteFlow?Flow=%2FSampleCallFlow.json</span>
        </div>
        <div class="mb-3">
          <label for="GreetingSay" class="form-label">Greeting Say</label>
          <input type="text" class="form-control" id="GreetingSay" placeholder="Thank you for Calling. Please wait while we locate an Agent. Call may be Recorded for Training Purposes." value="">
        </div>
        <div class="mb-3">
          <label for="GreetingPlay" class="form-label">Greeting Play</label>
          <input type="text" class="form-control" id="GreetingPlay" placeholder="http://example.com/sample.mp3">
        </div>

        <div class="mb-3">
          <label for="HuntSay" class="form-label">Hunt Say</label>
          <input type="text" class="form-control" id="HuntSay" placeholder="Please wait while we locate an Agent." value="">
        </div>
        <div class="mb-3">
          <label for="HuntPlay" class="form-label">Hunt Play</label>
          <input type="text" class="form-control" id="HuntPlay" placeholder="http://example.com/sample.mp3">
        </div>
        
        <div class="mb-3">
          <label class="form-label">Numbers to Call (numbers can be +15555551212 or sip:+15555551212@example.com seperated by commas)</label>
          <div class="DialContainer">
          </div>
        </div>
        
        <div class="mb-3">
          <div class="Voicemail">
            <div class="card">
              <div class="card-body">
                <label class="form-label">Voicemail</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="Enable">
                  <label class="form-check-label" for="Enable">
                    Enable Voicemail if No Answer
                  </label>
                </div>
                <div class="mb-3">
                  <label for="Say" class="form-label">Say</label>
                  <input type="text" class="form-control" id="Say" placeholder="Please Leave a Message." value="">
                </div>
                <div class="mb-3">
                  <label for="Play" class="form-label">Play</label>
                  <input type="text" class="form-control" id="Play" placeholder="http://example.com/sample.mp3">
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="PlayBeep">
                  <label class="form-check-label" for="PlayBeep">
                    Voicemail PlayBeep
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="Transcribe">
                  <label class="form-check-label" for="Transcribe">
                    Voicemail Transcribe
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="SmsNotify">
                  <label class="form-check-label" for="SmsNotify">
                    Voicemail Send SMS
                  </label>
                </div>
                <div class="mb-3">
                  <label for="SmsNotifyNumbers" class="form-label">SMS Notify Numbers</label>
                  <input type="text" class="form-control" id="SmsNotifyNumbers" placeholder="+15555551212">
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="EmailNotify">
                  <label class="form-check-label" for="EmailNotify">Voicemail Send Email</label>
                </div>
                <div class="mb-3">
                  <label for="EmailNotifyAddresses" class="form-label">Email Address</label>
                  <input type="text" class="form-control" id="EmailNotifyAddresses" placeholder="john@example.com, joe@example.com">
                </div>
                <div class="mb-3">
                  <label for="EmailNotifyFrom" class="form-label">Email From Address</label>
                  <input type="email" class="form-control" id="EmailNotifyFrom" placeholder="john@example.com">
                </div>
                <div class="mb-3">
                  <label for="EmailNotifySubject" class="form-label">Email Subject</label>
                  <input type="text" class="form-control" id="EmailNotifySubject" placeholder="Voicemail Message">
                </div>
              </div>
            </div>
          </div>
        </div>  
        <div class="mb-3">
          <div class="btn-group" role="group" aria-label="Load Save">
            <button class="btn btn-primary" id="btnSave" title="Saves to Text Area and Local Storage">Save</button>
            <button class="btn btn-primary" id="btnLoad" title="Parses and Loads Text Area Json" >Load</button>
          </div>
        </div>
        <div class="mb-3">
          <div id="ErrorDisplay" class="alert alert-danger hidden" role="alert">
          </div>
        </div>
        <div class="mb-3">
          <div>
            <textarea id="resultJson" class="form-control" style="min-width: 100%; min-height: 300px;"></textarea>
          </div>
        </div>
      </div>
      

      <div class="hidden" id="templates" style="display:none" >
        <div class="Dial">
          <div class="card">
            <div class="card-body">
              <div class="input-group">
                <label for="Numbers" class="form-label">Numbers</label>
                <input type="text" class="form-control" id="Numbers" placeholder="+15555551212">
              </div>
              <div class="input-group">
                <label for="DialTimeout" class="form-label">Answer Timeout</label>
                <input type="text" class="form-control" id="CallTimeout" placeholder="5">
                <label for="DialTimelimit" class="form-label">Call Timelimit</label>
                <input type="text" class="form-control" id="DialTimelimit" placeholder="3600">
                <label for="DialRecordTrim" class="form-label">Record Trim</label>
                <select type="text" class="form-control" id="DialTimelimit">
                  <option value="trim-silence">trim-silence</option>
                  <option value="trim-silence">do-not-trim</option>
                </select>
              </div>
              <div class="input-group">
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="Simulring">
                  <label class="form-check-label" for="Simulring">
                    Simulring <i class="bi bi-question-circle" title="Ring all numbers at same time"></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="CallerIdUseCalled">
                  <label class="form-check-label" for="CallerIdUseCalled">
                     Caller ID Use Called <i class="bi bi-question-circle" title="Outbound Caller ID will be set to Called number to Alert Answerer that is a forwarded call"></i>
                  </label>
                </div>
              </div>
              <div class="input-group">
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="Record">
                  <label class="form-check-label" for="Record">
                    Record Call
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="RecordSmsNotify">
                  <label class="form-check-label" for="RecordSmsNotify">
                    Record Send SMS <i class="bi bi-question-circle" title="Send SMS to the SMS Notify Numbers and/or Number that Answered"></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="SmsNotifyCalled">
                  <label class="form-check-label" for="SmsNotifyCalled">
                    Record Send SMS To Called <i class="bi bi-question-circle" title="Send SMS to the number that was called and answered this call"></i>
                  </label>
                </div>
                
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="Transcibe">
                  <label class="form-check-label" for="Transcribe">
                    Transcribe <i class="bi bi-question-circle" title="Transcribe Answered Call"></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="TranscibeSmsNotify">
                  <label class="form-check-label" for="TranscribeSmsNotify">
                    Transcribe Send SMS <i class="bi bi-question-circle" title="Send a SMS with Transcribed Message to Notify Numbers "></i>
                  </label>
                </div>
                <div class="form-check ms-2">
                  <input class="form-check-input" type="checkbox" value="" id="TranscibeSmsNotify">
                  <label class="form-check-label" for="TranscribeSmsNotify">
                    Transcribe Send SMS Called <i class="bi bi-question-circle" title="Send a SMS with Transcribed Message to Called and Answered Number "></i>
                  </label>
                </div>
              </div>
              <div>
                <label for="SmsNotifyNumbers" class="form-label">Sms Notify Numbers</label>
                <input type="text" class="form-control" id="SmsNotifyNumbers" placeholder="+15555551212">
              </div>
              <div>
                <label for="SmsNotifyTitle" class="form-label">Sms Notify Title</label>
                <input type="text" class="form-control" id="SmsNotifyTitle" placeholder="Call Recorded">
              </div>
            </div>
          </div>
        </div>
        
      </div>

      
  </body>
</html>
